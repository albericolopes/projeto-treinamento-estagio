<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
	<title>Cadastro de Jogadores</title>
</h:head>

<h:body>

	<!-- Botão Voltar -->
	<h:form>
		<div style="padding: 10px; background-color: #f8f9fa;">
			<p:commandButton value="Voltar ao Menu"
				action="index?faces-redirect=true" icon="pi pi-arrow-left"
				styleClass="p-button-outlined p-button-secondary" />
		</div>
	</h:form>

	<p:growl id="messages" showDetail="true" life="4000" />

	<!-- FORMULÁRIO DE CADASTRO -->
	<h:form id="playerForm">
		<p:panel header="Cadastro de Jogador" style="margin-bottom:20px;">
			<h:panelGrid columns="2" columnClasses="p-col-12 p-md-4 p-field"
				styleClass="p-fluid p-formgrid p-grid">
				<p:outputLabel for="name" value="Nome:" />
				<p:inputText id="name" value="#{playerMB.player.name}"
					required="true" requiredMessage="Nome é obrigatório" />

				<p:outputLabel for="height" value="Altura (m):" />
				<p:inputNumber id="height" value="#{playerMB.player.height}"
					required="true" requiredMessage="Altura é obrigatória" />

				<p:outputLabel for="birthDate" value="Data de Nascimento:" />
				<p:calendar id="birthDate" value="#{playerMB.player.birthDate}"
					pattern="dd/MM/yyyy" required="true"
					requiredMessage="Data de nascimento é obrigatória" showIcon="true" />

				<p:outputLabel for="position" value="Posição:" />
				<p:selectOneMenu id="position" value="#{playerMB.player.position}">
					<f:selectItem itemLabel="Selecione uma posição" itemValue=""
						noSelectionOption="true" />
					<f:selectItems value="#{playerMB.positions}" var="pos"
						itemLabel="#{pos.label}" itemValue="#{pos}" />
				</p:selectOneMenu>


				<p:outputLabel for="team" value="Time:" />
				<p:selectOneMenu id="team" value="#{playerMB.player.team}"
					converter="teamConverter">
					<f:selectItem itemLabel="Selecione um time" itemValue=""
						noSelectionOption="true" />
					<f:selectItems value="#{teamMB.teams}" var="t"
						itemLabel="#{t.name}" itemValue="#{t}" />
				</p:selectOneMenu>
			</h:panelGrid>

			<p:commandButton value="Salvar" action="#{playerMB.savePlayer}"
				update=":tableForm:playersTable :messages" icon="pi pi-save"
				disableOnClick="true" onstart="PF('statusDialog').show()"
				oncomplete="PF('statusDialog').hide()" />

			<p:commandButton value="Novo" action="#{playerMB.prepareNewPlayer}"
				update="playerForm" icon="pi pi-plus"
				styleClass="p-button-secondary" />
		</p:panel>
	</h:form>

	<!-- FORMULÁRIO DE BUSCA -->
	<h:form id="searchForm">
		<p:panel header="Buscar Jogadores">
			<p:toolbar>
				<p:toolbarGroup>
					<!-- Nome (continua como texto livre) -->
					<p:inputText id="searchNameInput" value="#{playerMB.searchName}"
						placeholder="Buscar por nome" style="width:200px;" />

					<!-- Posição (dropdown) -->
					<p:selectOneMenu id="searchPositionInput"
						value="#{playerMB.searchPosition}" style="width:200px;">
						<f:selectItem itemLabel="Buscar por posição" itemValue=""
							noSelectionOption="true" />
						<f:selectItems value="#{playerMB.positions}" var="pos"
							itemLabel="#{pos.label}" itemValue="#{pos}" />
					</p:selectOneMenu>

					<!-- ✅ Time (agora é dropdown também) -->
					<p:selectOneMenu id="searchTeamInput"
						value="#{playerMB.searchTeam}" converter="teamConverter"
						style="width:200px;">
						<f:selectItem itemLabel="Buscar por time" itemValue=""
							noSelectionOption="true" />
						<f:selectItems value="#{teamMB.teams}" var="t"
							itemLabel="#{t.name}" itemValue="#{t}" />
					</p:selectOneMenu>

					<!-- Botão Buscar -->
					<p:commandButton value="Buscar" action="#{playerMB.findPlayers}"
						update=":tableForm:playersTable :messages" icon="pi pi-search"
						process="@this searchNameInput searchPositionInput searchTeamInput" />
				</p:toolbarGroup>

				<p:toolbarGroup align="right">
					<!-- Botão Limpar Filtros -->
					<p:commandButton value="Limpar Filtros"
						action="#{playerMB.clearFilters}"
						update=":tableForm:playersTable :messages searchNameInput searchPositionInput searchTeamInput"
						icon="pi pi-times" styleClass="p-button-warning"
						style="margin-right: 10px;" />

					<!-- Botão Mostrar Todos -->
					<p:commandButton value="Mostrar Todos"
						action="#{playerMB.loadAllPlayers}"
						update=":tableForm:playersTable :messages" icon="pi pi-list"
						styleClass="p-button-secondary" />
				</p:toolbarGroup>
			</p:toolbar>
		</p:panel>
	</h:form>

	<!-- TABELA DE JOGADORES -->
	<h:form id="tableForm">
		<p:dataTable id="playersTable" value="#{playerMB.players}" var="p"
			paginator="true" rows="10" emptyMessage="Nenhum jogador encontrado."
			style="margin-top:10px">

			<p:column headerText="Nome">
				<h:outputText value="#{p.name}" />
			</p:column>

			<p:column headerText="Altura (m)">
				<h:outputText value="#{p.height}" />
			</p:column>

			<p:column headerText="Data Nascimento">
				<h:outputText value="#{p.birthDate}">
					<f:convertDateTime pattern="dd/MM/yyyy" />
				</h:outputText>
			</p:column>

			<p:column headerText="Posição">
				<h:outputText value="#{p.position != null ? p.position.label : ''}" />
			</p:column>

			<p:column headerText="Time">
				<h:outputText value="#{p.team != null ? p.team.name : ''}" />
			</p:column>

			<p:column headerText="Ações" style="width:120px; text-align:center;">
				<p:commandButton icon="pi pi-pencil"
					action="#{playerMB.editPlayer(p)}" update=":playerForm"
					process="@this" title="Editar"
					styleClass="p-button-rounded p-button-success p-button-outlined" />
				<p:commandButton icon="pi pi-trash"
					actionListener="#{playerMB.prepareDelete(p)}"
					oncomplete="PF('deleteDialog').show()" process="@this"
					update=":confirmDialogForm" title="Excluir"
					styleClass="p-button-danger p-button-rounded p-button-outlined" />
			</p:column>
		</p:dataTable>
	</h:form>

	<!-- DIALOGO DE CONFIRMAÇÃO DE EXCLUSÃO -->
	<h:form id="confirmDialogForm">
		<p:confirmDialog widgetVar="deleteDialog"
			header="Confirmação de Exclusão"
			message="Deseja realmente excluir este jogador?"
			icon="pi pi-exclamation-triangle" closable="false" resizable="false"
			draggable="false" width="400">

			<p:commandButton value="Sim" action="#{playerMB.deletePlayer}"
				update=":tableForm:playersTable :messages"
				oncomplete="PF('deleteDialog').hide()" styleClass="p-button-danger" />

			<p:commandButton value="Cancelar" type="button"
				onclick="PF('deleteDialog').hide()" styleClass="p-button-secondary" />
		</p:confirmDialog>
	</h:form>

</h:body>
</html>
